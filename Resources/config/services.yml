services:
    perform_notification.notifier:
        class: Perform\NotificationBundle\Notifier

    perform_notification.publisher.local:
        class: Perform\NotificationBundle\Publisher\LocalPublisher
        arguments:
            - "@doctrine.orm.entity_manager"
            - "@templating"
        tags:
            - {name: perform_notification.publisher}

    perform_notification.publisher.logger:
        class: Perform\NotificationBundle\Publisher\LoggerPublisher
        arguments:
            - "@logger"
        tags:
            - {name: perform_notification.publisher}

    perform_notification.publisher.email:
        class: Perform\NotificationBundle\Publisher\EmailPublisher
        arguments:
            - "@perform_base.email.mailer"
            - "@templating"
        tags:
            - {name: perform_notification.publisher}

    perform_notification.repository.notification_log:
        class: Perform\NotificationBundle\Repository\NotificationLogRepository
        factory: ['@doctrine.orm.default_entity_manager', 'getRepository']
        arguments:
          - PerformNotificationBundle:NotificationLog

    perform_notification.provider.current_user:
        class: Perform\NotificationBundle\RecipientProvider\CurrentUserProvider
        arguments: ["@security.token_storage"]

    perform_notification.provider.settings:
        class: Perform\NotificationBundle\RecipientProvider\SettingsProvider
        arguments: ["@doctrine.orm.entity_manager", "@perform_base.settings_manager"]

    perform_notification.twig.notification:
        class: Perform\NotificationBundle\Twig\Extension\NotificationExtension
        arguments: ['@perform_notification.provider.current_user', '@perform_notification.repository.notification_log']
        tags:
            - {name: twig.extension}

    perform_notification.data_collector:
        class: Perform\NotificationBundle\DataCollector\NotificationsDataCollector
        public: false
        arguments:
            - '@perform_notification.notifier'
        tags:
            -
                name: data_collector
                template: 'PerformNotificationBundle:data_collector:notifications.html.twig'
                id: 'perform_notification'
